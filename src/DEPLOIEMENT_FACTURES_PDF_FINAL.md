# ğŸ‰ SYSTÃˆME DE FACTURES PDF - PRÃŠT Ã€ DÃ‰PLOYER

## âœ… CE QUI A Ã‰TÃ‰ CORRIGÃ‰

### Informations Professionnelles
- âœ… **Nom correct** : FOULON Maxence (sans rÃ©pÃ©tition)
- âœ… **Adresse** : 33 Route Du Mans, 72650 La Milesse, France
- âœ… **SIRET** : 93763849200010
- âœ… **TVA** : TVA non applicable (au lieu de "non renseignÃ©e")
- âœ… **IBAN** : FR76 2823 3000 0195 1140 4606 069

### Structure du PDF
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FOULON Maxence .         FACTURE            â”‚
â”‚ Micro entrepreneur       FAC-2025-001       â”‚
â”‚ DÃ©veloppeur Web          10 novembre 2025   â”‚
â”‚                          [EnvoyÃ©e]          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ AU NOM ET POUR LE COMPTE DE                 â”‚
â”‚ FOULON Maxence                              â”‚
â”‚ 33 Route Du Mans                            â”‚
â”‚ 72650 La Milesse, France                    â”‚
â”‚ contact@maxence.design                      â”‚
â”‚                                             â”‚
â”‚ Entreprise Individuelle - Micro entrepreneurâ”‚
â”‚ SIRET : 93763849200010                      â”‚
â”‚ TVA non applicable                          â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ CLIENT                                      â”‚
â”‚ Nom du Client                               â”‚
â”‚ email@client.com                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ ğŸ’³ ModalitÃ©s de paiement                    â”‚
â”‚ Ã‰chÃ©ance : 10 dÃ©cembre 2025                 â”‚
â”‚ Moyens : Virement bancaire, PayPal         â”‚
â”‚ IBAN : FR76 2823 3000 0195 1140 4606 069    â”‚
â”‚                                             â”‚
â”‚ âš ï¸ Le paiement est dÃ» Ã  la date d'Ã©chÃ©ance. â”‚
â”‚ Tout rÃ¨glement effectuÃ© aprÃ¨s expiration    â”‚
â”‚ du dÃ©lai donnera lieu, Ã  titre de pÃ©nalitÃ©  â”‚
â”‚ de retard, Ã  la facturation d'un intÃ©rÃªt    â”‚
â”‚ de retard Ã©gal Ã  trois fois le taux         â”‚
â”‚ d'intÃ©rÃªt lÃ©gal en vigueur en France, Ã      â”‚
â”‚ compter de la date d'exigibilitÃ© de cette   â”‚
â”‚ prÃ©sente facture jusqu'Ã  la date de         â”‚
â”‚ paiement effectif, ainsi qu'Ã  une           â”‚
â”‚ indemnitÃ© forfaitaire pour frais de         â”‚
â”‚ recouvrement d'un montant de 40 â‚¬.          â”‚
â”‚ Les pÃ©nalitÃ©s de retard sont exigibles      â”‚
â”‚ sans qu'un rappel soit nÃ©cessaire.          â”‚
â”‚                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Merci pour votre confiance !                â”‚
â”‚ FOULON Maxence â€¢ 33 Route Du Mans           â”‚
â”‚ Entreprise Individuelle - SIRET : 937...    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“§ EMAILS ENVOYÃ‰S

### Email de Facture Standard
**Ã€ :** Client
**CC :** contact@maxence.design
**PiÃ¨ce jointe :** `Facture_XXX.pdf`

**Contenu du mail HTML :**
- Logo et branding (#00FFC2 + #0C0C0C)
- NumÃ©ro de facture
- Montant en gros
- Date d'Ã©chÃ©ance
- **IBAN visible** : FR76 2823 3000 0195 1140 4606 069
- Moyens de paiement (virement, PayPal)
- PDF professionnel en piÃ¨ce jointe
- Signature : Maxence FOULON

### Email de Relance (Facture en Retard)
**Ã€ :** Client
**CC :** contact@maxence.design
**PiÃ¨ce jointe :** `Facture_XXX_RELANCE.pdf`

**Contenu du mail HTML :**
- Message de rappel poli
- Nombre de jours de retard
- Montant et Ã©chÃ©ance dÃ©passÃ©e
- **IBAN bien visible**
- PDF joint pour rappel

## ğŸš€ COMMANDES DE DÃ‰PLOIEMENT

```bash
# 1. DÃ©ployer le serveur avec la nouvelle gÃ©nÃ©ration PDF
supabase functions deploy make-server-04919ac5

# 2. VÃ©rifier les logs
supabase functions logs make-server-04919ac5 --tail

# 3. Tester immÃ©diatement dans le dashboard
```

## âœ… CHECKLIST DE TEST

### Test 1 : CrÃ©er et envoyer une facture normale
1. Dashboard â†’ Factures â†’ Nouvelle facture
2. Remplir les infos client (avec email valide)
3. Montant : 1500 â‚¬
4. Ã‰chÃ©ance : dans 30 jours
5. Cliquer sur "Renvoyer" ğŸ“§
6. VÃ©rifier :
   - âœ… Toast de confirmation
   - âœ… Email reÃ§u par le client
   - âœ… PDF professionnel attachÃ©
   - âœ… Copie reÃ§ue sur contact@maxence.design
   - âœ… IBAN visible dans le mail
   - âœ… IBAN visible dans le PDF

### Test 2 : VÃ©rifier le contenu du PDF
Ouvrir le PDF et vÃ©rifier :
- âœ… Nom : "FOULON Maxence" (sans rÃ©pÃ©tition)
- âœ… Adresse : 33 Route Du Mans, 72650 La Milesse
- âœ… SIRET : 93763849200010
- âœ… TVA : "TVA non applicable" (pas "non renseignÃ©e")
- âœ… IBAN : FR76 2823 3000 0195 1140 4606 069
- âœ… Mentions lÃ©gales complÃ¨tes
- âœ… Design professionnel avec couleurs (#00FFC2)
- âœ… Pas d'erreur de rÃ©pÃ©tition ou de faute

### Test 3 : Tester une relance (facture en retard)
1. CrÃ©er une facture avec Ã©chÃ©ance passÃ©e
2. Statut : "overdue" ou "sent"
3. Envoyer la facture
4. VÃ©rifier :
   - âœ… Sujet : "âš ï¸ Facture XXX en attente de paiement"
   - âœ… Message de relance adaptÃ©
   - âœ… Nombre de jours de retard affichÃ©
   - âœ… IBAN visible dans le mail
   - âœ… PDF nommÃ© `Facture_XXX_RELANCE.pdf`

## ğŸ“Š LOGS Ã€ SURVEILLER

### âœ… Logs de SuccÃ¨s
```
ğŸ“„ Generating PDF for invoice FAC-2025-001...
âœ… PDF generated successfully for invoice FAC-2025-001 (45234 bytes)
ğŸ“§ Preparing to send email: { to: "client@email.com", hasAttachments: true }
ğŸ“§ Invoice email sent for invoice:... to client@email.com
```

### âŒ Erreurs Possibles
```
âŒ Failed to generate PDF: ...
â†’ Solution : VÃ©rifier que jsPDF s'importe bien

âŒ Failed to send email: ...
â†’ Solution : VÃ©rifier RESEND_API_KEY

âŒ No email for client in invoice ...
â†’ Solution : S'assurer que le client a un email valide
```

## ğŸ¨ PERSONNALISATION (SI BESOIN)

### Couleurs
Fichier : `/supabase/functions/server/pdf_service_simple.tsx`
```typescript
const primaryColor = [0, 255, 194]; // #00FFC2
const darkColor = [12, 12, 12];     // #0C0C0C
const grayColor = [102, 102, 102];  // #666
```

### Textes
- Ligne 59 : Sous-titre "Micro entrepreneur - DÃ©veloppeur Web Freelance"
- Ligne 243 : "ğŸ’³ ModalitÃ©s de paiement"
- Ligne 288 : "Merci pour votre confiance !"

### Informations par DÃ©faut
Fichier : `/supabase/functions/server/index.tsx` ligne 922-929
```typescript
const freelanceInfo = {
  name: "FOULON Maxence",
  email: "contact@maxence.design",
  phone: "",
  address: "33 Route Du Mans, 72650 La Milesse, France",
  siret: "93763849200010",
  tva: "TVA Intracommunautaire non renseignÃ©e"
};
```

## ğŸ’¡ FONCTIONNALITÃ‰S

### Automatiques
- âœ… GÃ©nÃ©ration PDF Ã  chaque envoi
- âœ… Copie automatique Ã  contact@maxence.design
- âœ… DÃ©tection automatique des retards
- âœ… Email adaptÃ© selon le statut
- âœ… Nom de fichier explicite

### SÃ©curitÃ©
- âœ… Authentification requise (Bearer token)
- âœ… Validation email
- âœ… Gestion des erreurs complÃ¨te
- âœ… Logs dÃ©taillÃ©s

### ConformitÃ© LÃ©gale
- âœ… SIRET
- âœ… TVA non applicable (micro-entrepreneur)
- âœ… IBAN
- âœ… Mentions pÃ©nalitÃ©s de retard conformes
- âœ… Conditions de paiement claires

## ğŸ“± UTILISATION DANS LE DASHBOARD

### Bouton "Renvoyer" ğŸ“§
**OÃ¹ ?** Dashboard â†’ Factures â†’ Colonne Actions

**Disponible pour :**
- Factures avec statut "sent"
- Factures avec statut "overdue"

**Action :**
1. Clic sur l'icÃ´ne Mail
2. GÃ©nÃ©ration auto du PDF
3. Envoi au client + CC Ã  vous
4. Toast de confirmation

**Messages :**
- âœ… Standard : "Facture renvoyÃ©e Ã  {client}"
- âš ï¸ Retard : "Relance envoyÃ©e pour {client} (5j de retard)"

## ğŸ¯ AVANTAGES

### Pour Vous
- âœ… Copie systÃ©matique de tous les envois
- âœ… Archivage auto des PDFs dans votre email
- âœ… TraÃ§abilitÃ© complÃ¨te
- âœ… Professionnalisme renforcÃ©

### Pour Vos Clients
- âœ… PDF professionnel et lisible
- âœ… IBAN directement accessible
- âœ… Toutes les infos nÃ©cessaires
- âœ… Facile Ã  archiver et imprimer

### Technique
- âœ… Aucune API tierce payante
- âœ… GÃ©nÃ©ration PDF cÃ´tÃ© serveur (jsPDF)
- âœ… LÃ©ger et rapide
- âœ… 100% open source

## ğŸ”§ VARIABLES D'ENVIRONNEMENT (OPTIONNELLES)

Si vous voulez personnaliser sans modifier le code :

```bash
# Dans Supabase Dashboard â†’ Secrets
supabase secrets set FREELANCE_NAME="FOULON Maxence"
supabase secrets set FREELANCE_EMAIL="contact@maxence.design"
supabase secrets set FREELANCE_ADDRESS="33 Route Du Mans, 72650 La Milesse, France"
supabase secrets set FREELANCE_SIRET="93763849200010"
supabase secrets set FREELANCE_TVA="TVA non applicable"
```

**Mais ce n'est PAS nÃ©cessaire car les valeurs par dÃ©faut sont dÃ©jÃ  correctes !**

## ğŸ“ DÃ‰PANNAGE

### PDF non gÃ©nÃ©rÃ©
**SymptÃ´me :** Email sans piÃ¨ce jointe
**Solution :**
1. VÃ©rifier les logs : `supabase functions logs make-server-04919ac5`
2. Chercher "Failed to generate PDF"
3. VÃ©rifier que jsPDF est bien importÃ©

### Email non reÃ§u
**SymptÃ´me :** Pas d'email
**Solution :**
1. VÃ©rifier le spam
2. VÃ©rifier RESEND_API_KEY
3. Consulter le dashboard Resend

### Copie non reÃ§ue
**SymptÃ´me :** Client reÃ§oit mais pas vous
**Solution :**
1. VÃ©rifier vos spams
2. Confirmer que CC = contact@maxence.design
3. Consulter les logs

## ğŸ‰ C'EST PRÃŠT !

Tout est configurÃ© avec vos **vraies informations** :
- âœ… FOULON Maxence
- âœ… 33 Route Du Mans, 72650 La Milesse, France
- âœ… SIRET : 93763849200010
- âœ… TVA non applicable
- âœ… IBAN : FR76 2823 3000 0195 1140 4606 069

**Une seule commande pour dÃ©ployer :**

```bash
supabase functions deploy make-server-04919ac5
```

**Puis testez immÃ©diatement dans le dashboard !**

Vos factures seront dÃ©sormais envoyÃ©es avec un **PDF professionnel**, l'**IBAN visible**, et une **copie automatique** pour vous. ğŸš€ğŸ“§ğŸ“„
